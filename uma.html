<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skills Directory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* A light gray background */
        }
        /* Custom scrollbar for a more subtle look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .skill-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .skill-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Simple spinner animation */
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div class="container mx-auto px-4 py-8 md:py-12">
        <!-- Header Section -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">Skills Directory</h1>
            <p class="text-lg text-gray-600 mt-2">A comprehensive list of skills fetched live from Google Sheets.</p>
        </header>

        <!-- Search and Filter Section -->
        <div class="mb-8 sticky top-4 z-10 bg-f3f4f6/80 backdrop-blur-sm p-4 rounded-lg">
            <div class="max-w-2xl mx-auto space-y-4">
                <div>
                    <label for="search" class="sr-only">Filter skills by name</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <input type="text" id="search" class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm shadow-sm" placeholder="Filter skills by name...">
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="rank-team-trials" class="block text-sm font-medium text-gray-700 mb-1">Rank (Team Trials)</label>
                        <select id="rank-team-trials" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                            <option value="all">All Ranks</option>
                            <option value="◎">◎</option>
                            <option value="◯">◯</option>
                            <option value="△">△</option>
                            <option value="▲">▲</option>
                            <option value="✕">✕</option>
                        </select>
                    </div>
                    <div>
                        <label for="rank-cm2" class="block text-sm font-medium text-gray-700 mb-1">Rank (CM2)</label>
                        <select id="rank-cm2" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                             <option value="all">All Ranks</option>
                            <option value="◎">◎</option>
                            <option value="◯">◯</option>
                            <option value="△">△</option>
                            <option value="▲">▲</option>
                            <option value="✕">✕</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Loading Indicator -->
        <div id="loading" class="flex justify-center items-center h-40">
            <div class="spinner"></div>
        </div>

        <!-- Skills Grid -->
        <div id="skills-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Skill cards will be inserted here by JavaScript -->
        </div>

        <!-- No Results Message -->
        <div id="no-results" class="text-center py-12 text-gray-500 hidden">
            <h3 class="text-xl font-semibold">No skills found</h3>
            <p>Try adjusting your search term or filters.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const skillsGrid = document.getElementById('skills-grid');
            const searchInput = document.getElementById('search');
            const teamTrialsFilter = document.getElementById('rank-team-trials');
            const cm2Filter = document.getElementById('rank-cm2');
            const loadingIndicator = document.getElementById('loading');
            const noResultsMessage = document.getElementById('no-results');

            // URLs from the user prompt
            const sheetUrls = [
                'https://docs.google.com/spreadsheets/u/0/d/1oB3eTvKqREtJDWJL0q80O_VjBcpOmRl5xE0z5fZKgFY/export?format=tsv&gid=634506155',
                'https://docs.google.com/spreadsheets/u/0/d/1oB3eTvKqREtJDWJL0q80O_VjBcpOmRl5xE0z5fZKgFY/export?format=tsv&gid=29696879',
                'https://docs.google.com/spreadsheets/u/0/d/1oB3eTvKqREtJDWJL0q80O_VjBcpOmRl5xE0z5fZKgFY/export?format=tsv&gid=1034190882',
                'https://docs.google.com/spreadsheets/u/0/d/1oB3eTvKqREtJDWJL0q80O_VjBcpOmRl5xE0z5fZKgFY/export?format=tsv&gid=148688425',
                'https://docs.google.com/spreadsheets/u/0/d/1oB3eTvKqREtJDWJL0q80O_VjBcpOmRl5xE0z5fZKgFY/export?format=tsv&gid=163743283',
                'https://docs.google.com/spreadsheets/u/0/d/1oB3eTvKqREtJDWJL0q80O_VjBcpOmRl5xE0z5fZKgFY/export?format=tsv&gid=247093628'
            ];

            // TSV parser that maps columns to an object.
            const parseTSV = (text) => {
                const rows = text.split(/\r?\n/).slice(1); // Skip header row
                return rows.map(row => {
                    if (!row) return null;
                    const columns = row.split('\t'); // Split by tab for TSV
                    return {
                        name: columns[0] || 'N/A',
                        rankTeamTrials: columns[1] || 'N/A',
                        rankCM2: columns[2] || 'N/A',
                        baseCost: columns[4] || 'N/A',
                        conditions: columns[5] || 'N/A',
                        why: columns[10] || 'N/A',
                    };
                }).filter(skill => skill && skill.name && skill.name !== 'N/A'); // Filter out empty or invalid rows
            };
            
            // Fetch all skills from the provided sheet URLs
            const fetchAllSkills = async () => {
                loadingIndicator.style.display = 'flex';
                skillsGrid.innerHTML = '';
                
                try {
                    const sheetNameMap = {
                        '634506155': 'speed',
                        '29696879': 'acceleration',
                        '1034190882': 'other',
                        '148688425': 'stamina',
                        '163743283': 'debuff',
                        '247093628': 'general'
                    };

                    const fetchPromises = sheetUrls.map(url => {
                        const gid = new URL(url).searchParams.get('gid');
                        const sheetName = sheetNameMap[gid] || 'unknown';

                        return fetch(url)
                            .then(res => {
                                if (!res.ok) {
                                    console.error(`Failed to fetch ${res.url}: ${res.statusText}`);
                                    return '';
                                }
                                return res.text();
                            })
                            .then(text => {
                                if (!text) return [];
                                const skills = parseTSV(text);
                                skills.forEach(skill => (skill.sheetName = sheetName));
                                return skills;
                            });
                    });

                    const skillGroups = await Promise.all(fetchPromises);
                    const allSkills = skillGroups.flat();
                    
                    const uniqueSkillsMap = new Map();
                    allSkills.forEach(skill => uniqueSkillsMap.set(skill.name, skill));
                    const uniqueSkills = Array.from(uniqueSkillsMap.values());
                    
                    uniqueSkills.sort((a, b) => a.name.localeCompare(b.name));
                    
                    return uniqueSkills;
                } catch (error) {
                    console.error('Error fetching or parsing skills data:', error);
                    skillsGrid.innerHTML = `<div class="col-span-full text-center text-red-500">Failed to load skills. Please check the console for errors.</div>`;
                    return [];
                } finally {
                    loadingIndicator.style.display = 'none';
                }
            };

            // Creates a colored badge for a skill rank
            const getRankBadgeHTML = (rank) => {
                if (!rank || rank === 'N/A') {
                    return `<span class="text-gray-800 font-medium">N/A</span>`;
                }
                const symbol = rank.charAt(0);
                let color = '#e5e7eb';
                let textColor = '#1f2937';
                switch (symbol) {
                    case '◎': color = '#b7e1cd'; textColor = '#064e3b'; break;
                    case '◯': color = '#eefff7'; textColor = '#065f46'; break;
                    case '△': color = '#fce5cd'; textColor = '#7c2d12'; break;
                    case '▲': color = '#fff2cc'; textColor = '#78350f'; break;
                    case '✕': color = '#f4cccc'; textColor = '#7f1d1d'; break;
                }
                return `<span class="px-2.5 py-0.5 text-sm font-semibold rounded-full" style="background-color: ${color}; color: ${textColor};">${rank}</span>`;
            };

            // Creates a colored badge for the sheet name (category)
            const getSheetNameBadgeHTML = (sheetName) => {
                if (!sheetName) return '';
                let bgColor = 'bg-gray-100';
                let textColor = 'text-gray-800';
                switch (sheetName) {
                    case 'speed': bgColor = 'bg-green-100'; textColor = 'text-green-800'; break;
                    case 'acceleration': bgColor = 'bg-yellow-100'; textColor = 'text-yellow-800'; break;
                    case 'stamina': bgColor = 'bg-blue-100'; textColor = 'text-blue-800'; break;
                    case 'debuff': bgColor = 'bg-red-100'; textColor = 'text-red-800'; break;
                    case 'other': bgColor = 'bg-purple-100'; textColor = 'text-purple-800'; break;
                    case 'general': bgColor = 'bg-gray-200'; textColor = 'text-gray-800'; break;
                }
                return `<span class="${bgColor} ${textColor} text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full capitalize">${sheetName}</span>`;
            };

            // Render the skills to the DOM with the new card format
            const renderSkills = (skills) => {
                skillsGrid.innerHTML = '';
                if (skills.length === 0) return;
                skills.forEach(skill => {
                    const card = document.createElement('div');
                    card.className = 'skill-card bg-white p-5 rounded-lg shadow-md border border-gray-200';
                    
                    // Add data attributes for efficient filtering
                    card.dataset.name = skill.name.toLowerCase();
                    card.dataset.rankTeamTrials = skill.rankTeamTrials;
                    card.dataset.rankCm2 = skill.rankCM2;

                    card.innerHTML = `
                        <div>
                            <h3 class="text-lg font-bold text-gray-900 mb-2">${skill.name}</h3>
                            <div class="mb-3">
                                ${getSheetNameBadgeHTML(skill.sheetName)}
                            </div>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-gray-600">Rank (Team Trials):</span>
                                    ${getRankBadgeHTML(skill.rankTeamTrials)}
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-gray-600">Rank (CM2):</span>
                                    ${getRankBadgeHTML(skill.rankCM2)}
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-semibold text-gray-600">Base Cost:</span>
                                    <span class="text-gray-800 font-medium">${skill.baseCost}</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-gray-200 text-sm space-y-2">
                            <div>
                                <h4 class="font-semibold text-gray-600 mb-1">Ground/Distance/Style:</h4>
                                <p class="text-gray-800 bg-gray-50 p-2 rounded-md">${skill.conditions}</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-600 mb-1">Why?</h4>
                                <p class="text-gray-800 bg-gray-50 p-2 rounded-md italic">${skill.why}</p>
                            </div>
                        </div>
                    `;
                    skillsGrid.appendChild(card);
                });
            };

            // Filter skills based on all active filters
            const filterSkills = () => {
                const searchTerm = searchInput.value.toLowerCase();
                const teamTrialsRank = teamTrialsFilter.value;
                const cm2Rank = cm2Filter.value;
                const skillCards = skillsGrid.children;
                let visibleCount = 0;
                
                Array.from(skillCards).forEach(card => {
                    const nameMatch = card.dataset.name.includes(searchTerm);
                    const teamTrialsMatch = (teamTrialsRank === 'all' || card.dataset.rankTeamTrials.startsWith(teamTrialsRank));
                    const cm2Match = (cm2Rank === 'all' || card.dataset.rankCm2.startsWith(cm2Rank));

                    if (nameMatch && teamTrialsMatch && cm2Match) {
                        card.style.display = 'flex';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });

                noResultsMessage.style.display = visibleCount === 0 ? 'block' : 'none';
            };

            // Initial load
            const init = async () => {
                const skills = await fetchAllSkills();
                renderSkills(skills);
                // Add event listeners to all filter controls
                searchInput.addEventListener('input', filterSkills);
                teamTrialsFilter.addEventListener('change', filterSkills);
                cm2Filter.addEventListener('change', filterSkills);
            };

            init();
        });
    </script>
</body>
</html>

